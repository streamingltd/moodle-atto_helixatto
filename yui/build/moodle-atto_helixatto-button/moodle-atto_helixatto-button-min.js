YUI.add("moodle-atto_helixatto-button",function(e,t){var n="atto_helixatto",r='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align" style="height:{{height}}px"><iframe id="medialiframe" style="border:0px;margin:0px;background:#ffffff;width:100%;height:{{iheight}};" src="{{iframesrc}}" allow="{{allow}}"></iframe><div class="{{hasfilter}}">{{get_string "inserttype" component}} <select id="medial_insert_type" name="medial_insert_type" class="custom-select"><option value="iframe">{{get_string "iframe" component}}</option><option value="thumbnail">{{get_string "thumbnail" component}}</option><option value="link">{{get_string "link" component}}</option></select></div><button id="medial_insert" class="btn btn-secondary submit {{hidden}}"> {{get_string "insert" component}}</button></div></form>',i=-1,s=!1,o="",u="",a="",f=null,l="",c=null,h=935,p=435,d=!1;e.namespace("M.atto_helixatto").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;if(window.location.href.indexOf("action=grader")>-1)return;this.addButton({icon:"ed/helixadd",iconComponent:"atto_helixatto",buttonName:"helixadd",callback:this._displayDialogue}),window.addEventListener("message",this._receiveMessage,!1),o=this.get("baseurl")+"/mod/helixmedia/launch.php",this.get("placeholder")==1?u="{{{medial_launch_base}}}/mod/helixmedia/launch.php":u=o,a=this.get("ltiurl"),l=this},_receiveMessage:function(e){if(typeof e.data=="string"||e.data instanceof String){var t=e.data.indexOf("preid_");t===0&&(i=e.data.substring(6),l.get("oauthConsumerKey")&&(f=setTimeout(l._checkStatus,5e3)))}typeof e.data=="object"&&l._setCustomLink(e.data)},_checkStatus:function(){var e=new XMLHttpRequest,t="resource_link_id="+i+"&user_id="+l.get("userid")+"&oauth_consumer_key="+l.get("oauthConsumerKey");e.open("POST",l.get("statusurl"),!1),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(t);if(c!==null&&c.get("visible")===!1){d=!1;return}e.responseText=="IN"&&(d=!0),e.responseText=="OUT"&&d===!0?(d=!1,l._doInsert()):f=setTimeout(l._checkStatus,2e3)},_displayDialogue:function(t){t.preventDefault(),l=this,s=!1;var r=document.documentElement.clientWidth-10,i=document.documentElement.clientHeight-55;r>935&&(r=935),i>1400&&(i=1400),h=r,p=i,c=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:r+"px",height:i+"px",draggable:!1,overflowX:"auto",constraintoviewport:!1}),c.width!==r+"px"&&c.set("width",r+"px");var o="",u="100%";l.get("hideinsert")=="1"&&(o="hidden");var a="hidden";l.get("hasfilter")&&(a="");if(l.get("hideinsert")=="1"||l.get("hasfilter"))u=i-135+"px";var f=this._getFormContent(o,u,a),d=e.Node.create("<div></div>");d.append(f),c.set("bodyContent",d),c.show()},_getFormContent:function(t,i,s){var u=e.Handlebars.compile(r),f=e.Node.create(u({elementid:this.get("host").get("elementid"),component:n,iframesrc:o+"?type=15&modtype="+this.get("modtype"),allow:"microphone "+a+"; camera "+a+"; display-capture "+a+";",width:h-30,height:p-90,style:"border:0px;",hidden:t,iheight:i,hasfilter:s}));return this._form=f,this._form.one("#medial_insert").on("click",this._doInsert,this),f},_doInsert:function(e){typeof e!="undefined"&&e.preventDefault();if(s)return;var t=this,n=new XMLHttpRequest,r="resource_link_id="+i+"&user_id="+l.get("userid")+"&oauth_consumer_key="+l.get("oauthConsumerKey")+"&context_id="+l.get("course")+"&include_height=Y";n.onload=function(){if(n.status>=200&&n.status<400){var e=n.responseText.split(":"),r=0;e.length==3&&e[2]=="Y"&&(r=1),t._setLink(r,"",!1)}},n.open("POST",l.get("playersizeurl"),!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(r)},_setCustomLink:function(e){if(!("title"in e&&"custom"in e&&"audioonly"in e.custom)){console.log("Bad message data"),console.log(e);return}var t=0;e.custom.audioonly.toLowerCase()==="true"&&(t=1),l._setLink(t,e.title,e.custom.video_ref)},_setLink:function(e,t,r){var o="iframe",a=document.getElementById("medial_insert_type");a&&(o=a.value),s=!0,l.editor.focus();var f=u+"?type=16&responsive=1&medialembed="+o+"&audioonly="+e+"&l="+i;r&&(f+="&video_ref="+r);var h="";l.get("linkonly")||o!="iframe"?h="<a href='"+f+"' title='"+t+"' target='_blank'>"+M.util.get_string("showvideo",n)+"</a>":(e==1?h="<div class='embed-responsive helixmedia_embedheight' style='height:100px' id='mediallaunch-"+i+"'>":h="<div class='embed-responsive embed-responsive-16by9 helixmedia_embedheight' id='mediallaunch-"+i+"'>",h+="<iframe class='embed-responsive-item overflow-auto border-0' src='"+f+"' allowfullscreen='true' webkitallowfullscreen='true' "+"mozallowfullscreen='true'></iframe></div>"),l.get("host").insertContentAtFocusPoint(h),l.markUpdated(),c.hide()}},{ATTRS:{disabled:{value:!1},linkonly:{value:!1},usercontextid:{value:null},baseurl:{value:""},ltiurl:{value:""},statusurl:{value:""},userid:{value:""},hideinsert:{value:""},insertdelay:{value:""},oauthConsumerKey:{value:""},modtype:{value:""},placeholder:{value:!1},playersizeurl:{value:""},course:{value:0},hasfilter:{value:!1}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
